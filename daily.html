<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Daily Focus</title>
  <style>
    :root{
      --bg0:#0b0d0c;
      --text:#e8f2ee;
      --muted:#9aa7a3;
      --accent:#a8f0b3;
      --shadow: 0 10px 30px rgba(0,0,0,.45);
      --radius: 18px;

      --panel-bg: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      --panel-border: 1px solid rgba(255,255,255,.06);
      --card-bg: rgba(0,0,0,.25);
      --card-border: 1px solid rgba(255,255,255,.06);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background: radial-gradient(1200px 800px at 50% 0%, #141a18 0%, var(--bg0) 55%, #070807 100%);
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding: 20px 18px 26px;
    }

    .wrap{
      width: 980px;
      max-width: 100%;
    }

    .header{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap: 14px;
      margin-bottom: 12px;
      padding-top: 8px;
      border-top: 1px solid rgba(255,255,255,.10);
    }

    .header h1{
      margin:0;
      font-size: 20px;
      font-weight: 950;
      letter-spacing:.2px;
      display:flex;
      align-items:center;
      gap: 10px;
    }

    .meta{
      color: rgba(154,167,163,.95);
      font-size: 12px;
      font-weight: 800;
      white-space: nowrap;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.35fr 1fr;
      gap: 14px;
      align-items:start;
    }

    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
    }

    .panel{
      background: var(--panel-bg);
      border: var(--panel-border);
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      padding: 16px;
    }

    .panel h2{
      margin:0 0 10px 0;
      font-size: 14px;
      font-weight: 950;
      letter-spacing:.2px;
      color: rgba(232,242,238,.94);
    }

    .hero{
      background: rgba(0,0,0,.22);
      border: 1px solid rgba(255,255,255,.06);
      border-radius: 16px;
      padding: 14px;
    }

    .headline{
      font-size: 22px;
      font-weight: 980;
      letter-spacing:.2px;
      margin: 0;
    }

    .subhead{
      margin: 6px 0 0 0;
      color: rgba(154,167,163,.95);
      font-size: 12px;
      font-weight: 750;
      line-height: 1.35;
    }

    .two{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 12px;
    }
    @media (max-width: 540px){
      .two{ grid-template-columns: 1fr; }
    }

    .list{
      display:flex;
      flex-direction:column;
      gap: 8px;
      margin-top: 10px;
    }

    .item{
      display:flex;
      align-items:flex-start;
      gap: 10px;
      padding: 10px 10px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.06);
      background: rgba(10,12,12,.55);
    }

    .dot{
      width: 10px;
      height: 10px;
      border-radius: 999px;
      margin-top: 4px;
      background: rgba(168,240,179,.85);
      box-shadow: 0 0 12px rgba(168,240,179,.12);
      flex: 0 0 auto;
    }

    .text{
      font-size: 13px;
      font-weight: 850;
      line-height: 1.25;
      color: rgba(248,252,250,.96);
      text-shadow: 0 1px 0 rgba(0,0,0,.55);
    }

    .chip{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.03);
      font-size: 11px;
      font-weight: 900;
      letter-spacing:.2px;
      color: rgba(232,242,238,.90);
      margin-left: 8px;
    }

    /* Checklist */
    .checklist{
      display:flex;
      flex-direction:column;
      gap: 8px;
    }

    .check{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      padding: 10px 10px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.06);
      background: rgba(10,12,12,.55);
    }

    .check-left{
      display:flex;
      align-items:center;
      gap: 10px;
      min-width: 0;
    }

    .box{
      width: 16px;
      height: 16px;
      border-radius: 5px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.25);
      flex: 0 0 auto;
      position: relative;
    }

    .done .box{
      border-color: rgba(168,240,179,.40);
      background: rgba(168,240,179,.12);
    }
    .done .box::after{
      content:"";
      position:absolute;
      left: 4px;
      top: 1px;
      width: 6px;
      height: 10px;
      border-right: 2px solid rgba(168,240,179,.95);
      border-bottom: 2px solid rgba(168,240,179,.95);
      transform: rotate(40deg);
    }

    .check-text{
      font-size: 13px;
      font-weight: 850;
      line-height: 1.25;
      color: rgba(248,252,250,.96);
      text-shadow: 0 1px 0 rgba(0,0,0,.55);
      overflow:hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .pct{
      color: rgba(154,167,163,.95);
      font-size: 11px;
      font-weight: 900;
      white-space: nowrap;
    }

    .bar{
      margin-top: 10px;
      height: 10px;
      border-radius: 999px;
      background: rgba(0,0,0,.22);
      border: 1px solid rgba(255,255,255,.10);
      overflow:hidden;
    }
    .bar > div{
      height:100%;
      width: 0%;
      background: linear-gradient(90deg, rgba(168,240,179,.92), rgba(120,217,138,.92));
      box-shadow: 0 0 18px rgba(168,240,179,.12);
    }

    /* Notes */
    .notes{
      white-space: pre-wrap;
      color: rgba(232,242,238,.88);
      font-size: 13px;
      line-height: 1.35;
      font-weight: 750;
      background: rgba(10,12,12,.50);
      border: 1px solid rgba(255,255,255,.06);
      border-radius: 14px;
      padding: 12px;
    }

    .error{
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,80,80,.25);
      background: rgba(255,80,80,.06);
      color: rgba(232,242,238,.90);
      font-size: 12px;
      font-weight: 750;
      line-height: 1.35;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="header">
      <h1>↗ <span id="title">Daily Focus</span></h1>
      <div class="meta" id="meta">Loading…</div>
    </div>

    <div class="grid">
      <!-- Left: Focus -->
      <div class="panel">
        <h2>Focus</h2>

        <div class="hero">
          <p class="headline" id="headline">—</p>
          <p class="subhead" id="subhead">—</p>

          <div class="two">
            <div>
              <h2 style="margin-top:14px;">Top priorities</h2>
              <div class="list" id="priorities"></div>
            </div>

            <div>
              <h2 style="margin-top:14px;">Win conditions</h2>
              <div class="list" id="wins"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Right: Checklist + Notes -->
      <div class="panel">
        <h2>Checklist</h2>
        <div class="checklist" id="checklist"></div>

        <div class="bar" aria-label="Checklist completion">
          <div id="barFill"></div>
        </div>

        <div style="margin-top:14px; display:flex; align-items:baseline; justify-content:space-between; gap:10px;">
          <h2 id="notesPrompt" style="margin:0;">Notes</h2>
          <span class="chip" id="notesChip">daily.json</span>
        </div>
        <div class="notes" id="notesBody">—</div>

        <div id="err" class="error" style="display:none;"></div>
      </div>
    </div>
  </div>

  <script>
    const CONFIG = {
      url: "./daily.json",
      refreshMinutes: 5
    };

    function safeArray(x){ return Array.isArray(x) ? x : []; }

    function render(data){
      const titleEl = document.getElementById("title");
      const metaEl = document.getElementById("meta");
      const errEl = document.getElementById("err");
      errEl.style.display = "none";
      errEl.textContent = "";

      titleEl.textContent = data.title || "Daily Focus";

      // date label
      const now = new Date();
      const dateLabel =
        (data.dateLabel === "auto" || !data.dateLabel)
          ? now.toLocaleDateString(undefined, { weekday:"short", month:"short", day:"2-digit" })
          : String(data.dateLabel);

      document.getElementById("headline").textContent = data?.focus?.headline || "—";
      document.getElementById("subhead").textContent = data?.focus?.subhead || "";

      const prioritiesEl = document.getElementById("priorities");
      prioritiesEl.innerHTML = "";
      safeArray(data?.focus?.topPriorities).forEach(t => {
        const row = document.createElement("div");
        row.className = "item";
        row.innerHTML = `<div class="dot"></div><div class="text"></div>`;
        row.querySelector(".text").textContent = String(t);
        prioritiesEl.appendChild(row);
      });

      const winsEl = document.getElementById("wins");
      winsEl.innerHTML = "";
      safeArray(data?.focus?.winConditions).forEach(t => {
        const row = document.createElement("div");
        row.className = "item";
        row.innerHTML = `<div class="dot"></div><div class="text"></div>`;
        row.querySelector(".dot").style.background = "rgba(245,200,90,.90)";
        row.querySelector(".text").textContent = String(t);
        winsEl.appendChild(row);
      });

      // checklist
      const checklist = safeArray(data.checklist);
      const checklistEl = document.getElementById("checklist");
      checklistEl.innerHTML = "";

      const doneCount = checklist.filter(x => x && x.done === true).length;
      const total = checklist.length || 0;
      const pct = total ? Math.round((doneCount / total) * 100) : 0;

      checklist.forEach(item => {
        const row = document.createElement("div");
        row.className = "check" + (item.done ? " done" : "");
        row.innerHTML = `
          <div class="check-left">
            <div class="box" aria-hidden="true"></div>
            <div class="check-text"></div>
          </div>
          <div class="pct"></div>
        `;
        row.querySelector(".check-text").textContent = String(item.text || "");
        row.querySelector(".pct").textContent = item.done ? "done" : "";
        checklistEl.appendChild(row);
      });

      document.getElementById("barFill").style.width = `${pct}%`;

      // notes
      document.getElementById("notesPrompt").textContent = data?.notes?.prompt || "Notes";
      document.getElementById("notesBody").textContent = data?.notes?.body || "";

      metaEl.textContent = `${dateLabel} • ${pct}% checklist`;
    }

    async function refresh(){
      const metaEl = document.getElementById("meta");
      const errEl = document.getElementById("err");

      try {
        const bust = `cb=${Date.now()}`;
        const url = CONFIG.url.includes("?") ? `${CONFIG.url}&${bust}` : `${CONFIG.url}?${bust}`;
        const res = await fetch(url, { cache: "no-store" });
        if (!res.ok) throw new Error(`daily.json fetch failed: ${res.status}`);
        const data = await res.json();
        render(data);

        const now = new Date();
        metaEl.textContent = `${metaEl.textContent} • updated ${now.toLocaleTimeString([], { hour:"2-digit", minute:"2-digit" })}`;
      } catch (e) {
        errEl.style.display = "block";
        errEl.textContent = "Could not load daily.json. Make sure daily.json is in the repo root and Pages deployed.";
        metaEl.textContent = "Unavailable";
      }
    }

    refresh();
    setInterval(refresh, CONFIG.refreshMinutes * 60 * 1000);
  </script>
</body>
</html>
