<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Notion HQ Widgets</title>
  <style>
    :root{
      --bg0:#0b0d0c;
      --bg1:#121615;
      --card:#141a18;
      --muted:#9aa7a3;
      --text:#e8f2ee;
      --accent:#a8f0b3;
      --accent2:#78d98a;
      --stroke: rgba(168,240,179,.7);
      --shadow: 0 10px 30px rgba(0,0,0,.45);
      --radius: 18px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background: radial-gradient(1200px 800px at 50% 0%, #141a18 0%, var(--bg0) 55%, #070807 100%);
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding: 26px 18px;
    }

    .wrap{
      width: 980px;
      max-width: 100%;
    }

    /* ===== HQ Header ===== */
    .hq{
      text-align:center;
      margin-bottom: 18px;
    }
    .hq-title{
      margin: 0;
      font-size: 44px;
      font-weight: 900;
      letter-spacing: .8px;
    }
    .hq-rule{
      height: 1px;
      width: min(720px, 92%);
      margin: 14px auto 0;
      background: rgba(255,255,255,.10);
    }

    /* ===== Weather Row ===== */
    .weather-row{
      margin: 22px auto 22px;
      width: min(720px, 92%);
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 18px;
      padding: 12px 14px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.06);
      background: rgba(0,0,0,.18);
      box-shadow: 0 6px 18px rgba(0,0,0,.22);
    }

    .w-left{
      text-align:right;
      min-width: 180px;
    }
    .w-city{
      font-weight: 900;
      letter-spacing:.6px;
      font-size: 13px;
      text-transform: uppercase;
    }
    .w-label{
      font-weight: 800;
      letter-spacing:.6px;
      font-size: 11px;
      color: rgba(232,242,238,.85);
      opacity:.9;
      text-transform: uppercase;
      margin-top: 2px;
    }

    .w-icon{
      width: 34px;
      height: 34px;
      display:flex;
      align-items:center;
      justify-content:center;
      opacity: .92;
      filter: drop-shadow(0 0 10px rgba(168,240,179,.10));
    }

    .w-right{
      text-align:left;
      min-width: 220px;
      display:flex;
      flex-direction:column;
      gap: 2px;
    }
    .w-temp{
      font-size: 26px;
      font-weight: 950;
      letter-spacing: .3px;
      line-height: 1.1;
    }
    .w-desc{
      font-size: 12px;
      color: rgba(232,242,238,.82);
      font-weight: 750;
      letter-spacing: .2px;
      text-transform: lowercase;
    }
    .w-meta{
      margin-top: 2px;
      font-size: 11px;
      color: rgba(154,167,163,.95);
      font-weight: 700;
    }

    /* ===== Main layout ===== */
    .grid{
      display:grid;
      grid-template-columns: 1fr 360px;
      gap: 20px;
      align-items:start;
    }
    @media (max-width: 880px){
      .grid{ grid-template-columns: 1fr; }
      .w-left, .w-right{ min-width: unset; }
    }

    .panel{
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border: 1px solid rgba(255,255,255,.06);
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      padding: 18px;
    }

    .panel h2{
      margin: 0 0 14px 0;
      font-size: 18px;
      font-weight: 900;
      letter-spacing:.2px;
    }

    /* Countdown list */
    .countdown-list{
      display:flex;
      flex-direction:column;
      gap: 18px;
    }

    .cd-card{
      background: rgba(0,0,0,.25);
      border: 1px solid rgba(255,255,255,.06);
      border-radius: 16px;
      padding: 16px 16px 14px;
    }

    .cd-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      margin-bottom: 10px;
    }

    .cd-name{
      font-weight: 900;
      font-size: 18px;
      letter-spacing:.2px;
    }

    .cd-date{
      color: var(--muted);
      font-size: 12px;
      font-weight: 750;
      white-space: nowrap;
    }

    .tiles{
      display:flex;
      align-items:flex-end;
      gap: 10px;
      flex-wrap: wrap;
    }

    .tile{
      min-width: 76px;
      text-align:center;
    }

    .tile .num{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.06);
      border-radius: 10px;
      padding: 10px 10px;
      font-size: 28px;
      font-weight: 950;
      letter-spacing: 3px;
      color: var(--accent);
      text-shadow: 0 0 18px rgba(168,240,179,.15);
    }

    .tile .label{
      margin-top: 7px;
      font-size: 12px;
      color: #cbd7d2;
      opacity:.9;
      font-weight: 800;
      letter-spacing:.3px;
    }

    .to-go{
      display:flex;
      align-items:center;
      height: 46px;
      padding: 0 12px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,.06);
      background: rgba(255,255,255,.03);
      color: #b7c5c0;
      font-weight: 850;
      letter-spacing:.2px;
      font-size: 13px;
      text-transform: lowercase;
    }

    /* Life bar */
    .life{
      display:flex;
      flex-direction:column;
      gap: 12px;
    }

    .life-row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      color: var(--muted);
      font-size: 12px;
      font-weight: 800;
    }

    .life-box{
      position: relative;
      width: 100%;
      height: 170px;
      border-radius: 14px;
      border: 2px solid var(--stroke);
      background: rgba(0,0,0,.25);
      overflow: hidden;
    }

    .life-fill{
      position:absolute;
      inset: 0 auto 0 0;
      width: 35%;
      background: linear-gradient(180deg, rgba(168,240,179,.95), rgba(120,217,138,.92));
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.08);
    }

    .life-overlay{
      position:absolute;
      inset:0;
      background: linear-gradient(90deg, rgba(255,255,255,.07), rgba(255,255,255,0));
      pointer-events:none;
      mix-blend-mode: overlay;
      opacity:.35;
    }

    .life-text{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      font-size: 13px;
      font-weight: 900;
    }

    .life-text .pct{
      color: var(--accent);
    }

    .small{
      color: var(--muted);
      font-size: 12px;
      font-weight: 700;
      line-height: 1.35;
    }

    .hint{
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid rgba(255,255,255,.06);
      color: rgba(154,167,163,.95);
      font-size: 12px;
      font-weight: 700;
    }

    .tag{
      display:inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.03);
      font-size: 11px;
      font-weight: 900;
      letter-spacing:.2px;
      color: #cfe0da;
      margin-left: 8px;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <!-- HQ Header -->
    <div class="hq">
      <h1 class="hq-title">HQ</h1>
      <div class="hq-rule"></div>

      <!-- Weather -->
      <div class="weather-row" aria-label="San Antonio weather">
        <div class="w-left">
          <div class="w-city">SAN ANTONIO</div>
          <div class="w-label">WEATHER</div>
        </div>

        <div class="w-icon" id="weatherIcon" aria-hidden="true"></div>

        <div class="w-right">
          <div class="w-temp" id="weatherTemp">— °F</div>
          <div class="w-desc" id="weatherDesc">loading…</div>
          <div class="w-meta">
            <span id="tzLabel" class="tag">TZ: —</span>
            <span id="weatherUpdated" class="tag">Updated: —</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Main grid -->
    <div class="grid">
      <div class="panel">
        <h2>Vacation Countdowns</h2>
        <div id="countdownList" class="countdown-list"></div>
        <div class="hint">
          Edit trips inside <b>CONFIG.countdowns</b> in the code.
        </div>
      </div>

      <div class="panel life">
        <h2>Remaining Life</h2>

        <div class="life-box" aria-label="Life progress bar">
          <div class="life-fill" id="lifeFill" style="width:35%"></div>
          <div class="life-overlay"></div>
        </div>

        <div class="life-text">
          <div id="lifeSummary">Life: —</div>
          <div class="pct" id="lifePct">—%</div>
        </div>

        <div class="life-row">
          <div id="lifeDates">DOB — → End —</div>
          <div id="lifeAge">Age —</div>
        </div>

        <div class="small">
          This is a visualization: (today - DOB) ÷ (end - DOB). You control the end date.
        </div>

        <div class="hint">
          Edit <b>CONFIG.life.dob</b> and <b>CONFIG.life.end</b>.
        </div>
      </div>
    </div>
  </div>

  <script>
    /**
     * =========================
     * CONFIG — EDIT THIS
     * =========================
     */
    const CONFIG = {
      // San Antonio local timezone:
      timezoneLabel: "America/Chicago",

      countdowns: [
        { name: "Savannah, Georgia", date: "2026-01-30" },
        { name: "Santa Fe Photo Trip", date: "2026-02-26" },
        { name: "Splash House", date: "2026-08-08" },
      ],

      life: {
        dob: "1998-03-30",
        // Change this if you used something else in Indify (e.g., dob + 80 years)
        end: "2078-03-30",
        // true => shows Remaining % instead of Lived %
        showRemainingPercent: false
      },

      weather: {
        cityLabel: "San Antonio",
        // San Antonio, TX
        latitude: 29.4241,
        longitude: -98.4936,
        refreshMinutes: 15
      }
    };

    // ---------- Utilities ----------
    const pad2 = (n) => String(n).padStart(2, "0");

    function formatShortDate(d){
      return d.toLocaleDateString(undefined, { year:"numeric", month:"short", day:"2-digit" });
    }

    function parseLocalDate(input){
      // YYYY-MM-DD becomes local midnight (good for “countdown to day”)
      if (/^\d{4}-\d{2}-\d{2}$/.test(input)) {
        const [y,m,day] = input.split("-").map(Number);
        return new Date(y, m-1, day, 0, 0, 0, 0);
      }
      return new Date(input);
    }

    // Returns { months, weeks, days, isPast }
    function diffToTarget(now, target){
      const isPast = now >= target;
      if (isPast) return { months:0, weeks:0, days:0, isPast:true };

      let months = 0;
      let cursor = new Date(now.getTime());
      cursor.setHours(0,0,0,0);

      const tgt = new Date(target.getTime());
      tgt.setHours(0,0,0,0);

      while (true) {
        const next = new Date(cursor.getTime());
        next.setMonth(next.getMonth() + 1);
        if (next <= tgt) {
          months++;
          cursor = next;
        } else break;
      }

      const msPerDay = 24*60*60*1000;
      const remainingDaysTotal = Math.max(0, Math.floor((tgt - cursor) / msPerDay));
      const weeks = Math.floor(remainingDaysTotal / 7);
      const days = remainingDaysTotal % 7;

      return { months, weeks, days, isPast:false };
    }

    function buildCountdownCard(item){
      const target = parseLocalDate(item.date);

      const card = document.createElement("div");
      card.className = "cd-card";

      const head = document.createElement("div");
      head.className = "cd-head";

      const name = document.createElement("div");
      name.className = "cd-name";
      name.textContent = item.name;

      const date = document.createElement("div");
      date.className = "cd-date";
      date.textContent = formatShortDate(target);

      head.appendChild(name);
      head.appendChild(date);

      const tiles = document.createElement("div");
      tiles.className = "tiles";

      const makeTile = (label) => {
        const t = document.createElement("div");
        t.className = "tile";
        const num = document.createElement("div");
        num.className = "num";
        num.textContent = "00";
        const lab = document.createElement("div");
        lab.className = "label";
        lab.textContent = label;
        t.appendChild(num);
        t.appendChild(lab);
        return { t, num };
      };

      const m = makeTile("Months");
      const w = makeTile("Weeks");
      const d = makeTile("Days");

      const togo = document.createElement("div");
      togo.className = "to-go";
      togo.textContent = "to go";

      tiles.appendChild(m.t);
      tiles.appendChild(w.t);
      tiles.appendChild(d.t);
      tiles.appendChild(togo);

      card.appendChild(head);
      card.appendChild(tiles);

      return { card, target, nodes: { m:m.num, w:w.num, d:d.num, togo } };
    }

    function updateCountdown(cardObj){
      const now = new Date();
      const diff = diffToTarget(now, cardObj.target);
      cardObj.nodes.m.textContent = pad2(diff.months);
      cardObj.nodes.w.textContent = pad2(diff.weeks);
      cardObj.nodes.d.textContent = pad2(diff.days);
      cardObj.nodes.togo.textContent = diff.isPast ? "done" : "to go";
    }

    function updateLife(){
      const dob = parseLocalDate(CONFIG.life.dob);
      const end = parseLocalDate(CONFIG.life.end);
      const now = new Date();

      const total = Math.max(1, end - dob);
      const lived = Math.min(Math.max(0, now - dob), total);

      const livedPct = (lived / total) * 100;
      const remainingPct = 100 - livedPct;

      const pct = CONFIG.life.showRemainingPercent ? remainingPct : livedPct;

      const lifeFill = document.getElementById("lifeFill");
      const lifePctEl = document.getElementById("lifePct");
      const lifeSummary = document.getElementById("lifeSummary");
      const lifeDates = document.getElementById("lifeDates");
      const lifeAge = document.getElementById("lifeAge");

      lifeFill.style.width = `${Math.max(0, Math.min(100, pct)).toFixed(1)}%`;
      lifePctEl.textContent = `${pct.toFixed(1)}%`;

      const label = CONFIG.life.showRemainingPercent ? "Remaining" : "Lived";
      lifeSummary.textContent = `${label}: ${pct.toFixed(1)}%`;

      lifeDates.textContent = `DOB ${formatShortDate(dob)} → End ${formatShortDate(end)}`;

      let age = now.getFullYear() - dob.getFullYear();
      const m = now.getMonth() - dob.getMonth();
      if (m < 0 || (m === 0 && now.getDate() < dob.getDate())) age--;
      lifeAge.textContent = `Age ${age}`;
    }

    // ---------- Weather (Open-Meteo, no key) ----------
    function weatherCodeToText(code){
      // Open-Meteo WMO codes (common groupings)
      if (code === 0) return "clear sky";
      if (code === 1) return "mainly clear";
      if (code === 2) return "partly cloudy";
      if (code === 3) return "overcast clouds";
      if (code === 45 || code === 48) return "fog";
      if (code === 51 || code === 53 || code === 55) return "drizzle";
      if (code === 56 || code === 57) return "freezing drizzle";
      if (code === 61 || code === 63 || code === 65) return "rain";
      if (code === 66 || code === 67) return "freezing rain";
      if (code === 71 || code === 73 || code === 75) return "snow";
      if (code === 77) return "snow grains";
      if (code === 80 || code === 81 || code === 82) return "rain showers";
      if (code === 85 || code === 86) return "snow showers";
      if (code === 95) return "thunderstorm";
      if (code === 96 || code === 99) return "thunderstorm w/ hail";
      return "conditions";
    }

    function iconSVG(kind){
      // Minimal inline SVG icons in your accent vibe
      const stroke = "rgba(232,242,238,.85)";
      const fill = "rgba(232,242,238,.18)";
      const accent = "rgba(168,240,179,.85)";

      if (kind === "sun") {
        return `
          <svg width="34" height="34" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <circle cx="12" cy="12" r="4.5" stroke="${accent}" stroke-width="1.6"/>
            <path d="M12 2v3M12 19v3M2 12h3M19 12h3M4.2 4.2l2.1 2.1M17.7 17.7l2.1 2.1M19.8 4.2l-2.1 2.1M6.3 17.7l-2.1 2.1"
              stroke="${stroke}" stroke-width="1.2" stroke-linecap="round"/>
          </svg>`;
      }

      if (kind === "cloud") {
        return `
          <svg width="34" height="34" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M8.5 18h9a4 4 0 0 0 .7-7.94A5.5 5.5 0 0 0 7.2 8.8 3.8 3.8 0 0 0 8.5 18Z"
              fill="${fill}" stroke="${stroke}" stroke-width="1.2" />
          </svg>`;
      }

      if (kind === "rain") {
        return `
          <svg width="34" height="34" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M8.5 14.5h9a3.5 3.5 0 0 0 .6-6.95A5 5 0 0 0 7.3 6.6 3.3 3.3 0 0 0 8.5 14.5Z"
              fill="${fill}" stroke="${stroke}" stroke-width="1.2" />
            <path d="M9 17l-1 2M13 17l-1 2M17 17l-1 2" stroke="${accent}" stroke-width="1.4" stroke-linecap="round"/>
          </svg>`;
      }

      if (kind === "storm") {
        return `
          <svg width="34" height="34" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M8.5 14.5h9a3.5 3.5 0 0 0 .6-6.95A5 5 0 0 0 7.3 6.6 3.3 3.3 0 0 0 8.5 14.5Z"
              fill="${fill}" stroke="${stroke}" stroke-width="1.2" />
            <path d="M12 14.8l-2 3h2l-1 2.8 3-4h-2l1-1.8Z" fill="${accent}" />
          </svg>`;
      }

      // default
      return iconSVG("cloud");
    }

    function pickIcon(weatherCode){
      if (weatherCode === 0 || weatherCode === 1) return "sun";
      if (weatherCode === 2 || weatherCode === 3 || weatherCode === 45 || weatherCode === 48) return "cloud";
      if ([51,53,55,56,57,61,63,65,66,67,80,81,82,71,73,75,77,85,86].includes(weatherCode)) return "rain";
      if ([95,96,99].includes(weatherCode)) return "storm";
      return "cloud";
    }

    async function refreshWeather(){
      const tempEl = document.getElementById("weatherTemp");
      const descEl = document.getElementById("weatherDesc");
      const iconEl = document.getElementById("weatherIcon");
      const updatedEl = document.getElementById("weatherUpdated");

      try {
        const lat = CONFIG.weather.latitude;
        const lon = CONFIG.weather.longitude;
        const tz = encodeURIComponent(CONFIG.timezoneLabel);

        const url =
          `https://api.open-meteo.com/v1/forecast` +
          `?latitude=${lat}&longitude=${lon}` +
          `&current=temperature_2m,weather_code` +
          `&temperature_unit=fahrenheit` +
          `&timezone=${tz}`;

        const res = await fetch(url, { cache: "no-store" });
        if (!res.ok) throw new Error(`Weather fetch failed: ${res.status}`);
        const data = await res.json();

        const t = data?.current?.temperature_2m;
        const code = data?.current?.weather_code;

        if (typeof t !== "number" || typeof code !== "number") {
          throw new Error("Weather data missing fields");
        }

        tempEl.textContent = `${Math.round(t)} °F`;
        descEl.textContent = weatherCodeToText(code);

        const iconKind = pickIcon(code);
        iconEl.innerHTML = iconSVG(iconKind);

        const now = new Date();
        updatedEl.textContent = `Updated: ${now.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" })}`;
      } catch (e) {
        // Fail gracefully
        descEl.textContent = "weather unavailable";
        iconEl.innerHTML = iconSVG("cloud");
        updatedEl.textContent = "Updated: —";
      }
    }

    // ---------- Init ----------
    const tzLabel = document.getElementById("tzLabel");
    tzLabel.textContent = `TZ: ${CONFIG.timezoneLabel}`;

    const list = document.getElementById("countdownList");
    const cardObjs = CONFIG.countdowns.map(item => {
      const obj = buildCountdownCard(item);
      list.appendChild(obj.card);
      return obj;
    });

    function tick(){
      cardObjs.forEach(updateCountdown);
      updateLife();
    }

    tick();
    refreshWeather();

    // Countdown/Life refresh once per minute
    setInterval(tick, 60 * 1000);

    // Weather refresh every N minutes
    setInterval(refreshWeather, CONFIG.weather.refreshMinutes * 60 * 1000);
  </script>
</body>
</html>
