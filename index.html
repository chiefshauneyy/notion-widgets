<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Notion HQ Widgets</title>
  <style>
    :root{
      --bg0:#0b0d0c;
      --text:#e8f2ee;
      --muted:#9aa7a3;
      --accent:#a8f0b3;
      --accent2:#78d98a;
      --stroke: rgba(168,240,179,.7);
      --shadow: 0 10px 30px rgba(0,0,0,.45);
      --radius: 18px;

      --panel-bg: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      --panel-border: 1px solid rgba(255,255,255,.06);
      --card-bg: rgba(0,0,0,.25);
      --card-border: 1px solid rgba(255,255,255,.06);

      /* Goals base */
      --goals-gap: 14px;
      --goals-col-radius: 16px;
      --goals-card-radius: 14px;

      /* Notion-like column colors */
      --na-bg: rgba(255,255,255,.04);
      --na-border: rgba(255,255,255,.08);
      --na-accent: rgba(180, 190, 195, .95);

      --pl-bg: rgba(80, 145, 255, .13);
      --pl-border: rgba(80, 145, 255, .25);
      --pl-accent: rgba(120, 170, 255, .95);

      --ip-bg: rgba(230, 180, 70, .13);
      --ip-border: rgba(230, 180, 70, .25);
      --ip-accent: rgba(245, 200, 90, .95);

      --dn-bg: rgba(60, 190, 120, .13);
      --dn-border: rgba(60, 190, 120, .25);
      --dn-accent: rgba(110, 220, 160, .95);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background: radial-gradient(1200px 800px at 50% 0%, #141a18 0%, var(--bg0) 55%, #070807 100%);
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding: 26px 18px;
    }

    .wrap{
      width: 980px;
      max-width: 100%;
    }

    /* ===== HQ Header ===== */
    .hq{
      text-align:center;
      margin-bottom: 18px;
    }
    .hq-title{
      margin: 0;
      font-size: 44px;
      font-weight: 900;
      letter-spacing: .8px;
    }
    .hq-rule{
      height: 1px;
      width: min(720px, 92%);
      margin: 14px auto 0;
      background: rgba(255,255,255,.10);
    }

    /* ===== Weather Row ===== */
    .weather-row{
      margin: 22px auto 22px;
      width: min(720px, 92%);
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 18px;
      padding: 12px 14px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.06);
      background: rgba(0,0,0,.18);
      box-shadow: 0 6px 18px rgba(0,0,0,.22);
    }

    .w-left{
      text-align:right;
      min-width: 180px;
    }
    .w-city{
      font-weight: 900;
      letter-spacing:.6px;
      font-size: 13px;
      text-transform: uppercase;
    }
    .w-label{
      font-weight: 800;
      letter-spacing:.6px;
      font-size: 11px;
      color: rgba(232,242,238,.85);
      opacity:.9;
      text-transform: uppercase;
      margin-top: 2px;
    }

    .w-icon{
      width: 34px;
      height: 34px;
      display:flex;
      align-items:center;
      justify-content:center;
      opacity: .92;
      filter: drop-shadow(0 0 10px rgba(168,240,179,.10));
    }

    .w-right{
      text-align:left;
      min-width: 260px;
      display:flex;
      flex-direction:column;
      gap: 2px;
    }
    .w-temp{
      font-size: 26px;
      font-weight: 950;
      letter-spacing: .3px;
      line-height: 1.1;
    }
    .w-desc{
      font-size: 12px;
      color: rgba(232,242,238,.82);
      font-weight: 750;
      letter-spacing: .2px;
      text-transform: lowercase;
    }
    .w-meta{
      margin-top: 2px;
      display:flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    /* ===== Main layout ===== */
    .grid{
      display:grid;
      grid-template-columns: 1fr 360px;
      gap: 20px;
      align-items:start;
    }
    @media (max-width: 880px){
      .grid{ grid-template-columns: 1fr; }
      .w-left, .w-right{ min-width: unset; }
    }

    .panel{
      background: var(--panel-bg);
      border: var(--panel-border);
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      padding: 18px;
    }

    .panel h2{
      margin: 0 0 14px 0;
      font-size: 18px;
      font-weight: 900;
      letter-spacing:.2px;
    }

    /* Countdown list */
    .countdown-list{
      display:flex;
      flex-direction:column;
      gap: 18px;
    }

    .cd-card{
      background: var(--card-bg);
      border: var(--card-border);
      border-radius: 16px;
      padding: 16px 16px 14px;
    }

    .cd-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      margin-bottom: 10px;
    }

    .cd-name{
      font-weight: 900;
      font-size: 18px;
      letter-spacing:.2px;
    }

    .cd-date{
      color: var(--muted);
      font-size: 12px;
      font-weight: 750;
      white-space: nowrap;
    }

    .tiles{
      display:flex;
      align-items:flex-end;
      gap: 10px;
      flex-wrap: wrap;
    }

    .tile{
      min-width: 76px;
      text-align:center;
    }

    .tile .num{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.06);
      border-radius: 10px;
      padding: 10px 10px;
      font-size: 28px;
      font-weight: 950;
      letter-spacing: 3px;
      color: var(--accent);
      text-shadow: 0 0 18px rgba(168,240,179,.15);
    }

    .tile .label{
      margin-top: 7px;
      font-size: 12px;
      color: #cbd7d2;
      opacity:.9;
      font-weight: 800;
      letter-spacing:.3px;
    }

    .to-go{
      display:flex;
      align-items:center;
      height: 46px;
      padding: 0 12px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,.06);
      background: rgba(255,255,255,.03);
      color: #b7c5c0;
      font-weight: 850;
      letter-spacing:.2px;
      font-size: 13px;
      text-transform: lowercase;
    }

    /* Life bar */
    .life{
      display:flex;
      flex-direction:column;
      gap: 12px;
    }

    .life-row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      color: var(--muted);
      font-size: 12px;
      font-weight: 800;
    }

    .life-box{
      position: relative;
      width: 100%;
      height: 170px;
      border-radius: 14px;
      border: 2px solid var(--stroke);
      background: rgba(0,0,0,.25);
      overflow: hidden;
    }

    .life-fill{
      position:absolute;
      inset: 0 auto 0 0;
      width: 35%;
      background: linear-gradient(180deg, rgba(168,240,179,.95), rgba(120,217,138,.92));
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.08);
    }

    .life-overlay{
      position:absolute;
      inset:0;
      background: linear-gradient(90deg, rgba(255,255,255,.07), rgba(255,255,255,0));
      pointer-events:none;
      mix-blend-mode: overlay;
      opacity:.35;
    }

    .life-text{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      font-size: 13px;
      font-weight: 900;
    }

    .life-text .pct{
      color: var(--accent);
    }

    .small{
      color: var(--muted);
      font-size: 12px;
      font-weight: 700;
      line-height: 1.35;
    }

    .hint{
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid rgba(255,255,255,.06);
      color: rgba(154,167,163,.95);
      font-size: 12px;
      font-weight: 700;
    }

    .tag{
      display:inline-block;
      padding: 2px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.03);
      font-size: 11px;
      font-weight: 900;
      letter-spacing:.2px;
      color: #cfe0da;
    }

    /* ===== Goals Section ===== */
    .section{
      margin-top: 18px;
    }

    .section-title{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 14px;
      margin: 18px 0 10px;
      padding-top: 14px;
      border-top: 1px solid rgba(255,255,255,.10);
    }

    .section-title h2{
      margin:0;
      font-size: 18px;
      font-weight: 950;
      letter-spacing:.2px;
      display:flex;
      align-items:center;
      gap: 10px;
    }

    .section-title .meta{
      color: rgba(154,167,163,.95);
      font-size: 12px;
      font-weight: 750;
    }

    .goals-board{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap: var(--goals-gap);
    }

    @media (max-width: 980px){
      .goals-board{ grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 520px){
      .goals-board{ grid-template-columns: 1fr; }
    }

    /* Column base */
    .g-col{
      border-radius: var(--goals-col-radius);
      padding: 12px;
      box-shadow: 0 10px 26px rgba(0,0,0,.26);
      min-height: 180px;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.12);
      position: relative;
      overflow: hidden;
    }

    /* Notion-like column color variants via data attribute */
    .g-col[data-col="not_active"]{
      background: linear-gradient(180deg, var(--na-bg), rgba(0,0,0,.16));
      border-color: var(--na-border);
    }
    .g-col[data-col="planned"]{
      background: linear-gradient(180deg, var(--pl-bg), rgba(0,0,0,.16));
      border-color: var(--pl-border);
    }
    .g-col[data-col="in_progress"]{
      background: linear-gradient(180deg, var(--ip-bg), rgba(0,0,0,.16));
      border-color: var(--ip-border);
    }
    .g-col[data-col="done"]{
      background: linear-gradient(180deg, var(--dn-bg), rgba(0,0,0,.16));
      border-color: var(--dn-border);
    }

    /* soft glow */
    .g-col::after{
      content:"";
      position:absolute;
      inset:-40% -20% auto -20%;
      height: 65%;
      background: radial-gradient(circle at 50% 50%, rgba(255,255,255,.08), rgba(255,255,255,0) 60%);
      opacity:.35;
      pointer-events:none;
    }

    .g-colhead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      margin-bottom: 10px;
      position: relative;
      z-index: 1;
    }

    .g-pill{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      font-size: 12px;
      font-weight: 950;
      letter-spacing:.2px;
      color: rgba(232,242,238,.94);
      text-transform: none;
    }

    .g-count{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      min-width: 26px;
      height: 22px;
      padding: 0 8px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 950;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      color: rgba(232,242,238,.90);
    }

    /* header accents by column id */
    .g-col[data-col="not_active"] .g-pill,
    .g-col[data-col="not_active"] .g-count{
      border-color: rgba(180,190,195,.35);
    }
    .g-col[data-col="planned"] .g-pill,
    .g-col[data-col="planned"] .g-count{
      border-color: rgba(120,170,255,.40);
    }
    .g-col[data-col="in_progress"] .g-pill,
    .g-col[data-col="in_progress"] .g-count{
      border-color: rgba(245,200,90,.40);
    }
    .g-col[data-col="done"] .g-pill,
    .g-col[data-col="done"] .g-count{
      border-color: rgba(110,220,160,.40);
    }

    .g-list{
      display:flex;
      flex-direction:column;
      gap: 10px;
      position: relative;
      z-index: 1;
    }

    .g-card{
      border-radius: var(--goals-card-radius);
      padding: 10px 10px 9px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.14);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
    }

    /* Card tint by column (subtle but Notion-like) */
    .g-col[data-col="planned"] .g-card{
      background: rgba(80,145,255,.10);
      border-color: rgba(80,145,255,.18);
    }
    .g-col[data-col="in_progress"] .g-card{
      background: rgba(230,180,70,.10);
      border-color: rgba(230,180,70,.18);
    }
    .g-col[data-col="done"] .g-card{
      background: rgba(60,190,120,.10);
      border-color: rgba(60,190,120,.18);
    }
    .g-col[data-col="not_active"] .g-card{
      background: rgba(255,255,255,.04);
      border-color: rgba(255,255,255,.10);
    }

    .g-row{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 10px;
    }

    .g-title{
      font-size: 13px;
      font-weight: 950;
      line-height: 1.25;
      color: rgba(232,242,238,.94);
      display:flex;
      gap: 8px;
      align-items:flex-start;
    }

    .g-emoji{ width: 18px; text-align:center; }

    .g-meta{
      color: rgba(232,242,238,.78);
      font-size: 12px;
      font-weight: 900;
      white-space: nowrap;
      margin-top: 1px;
      opacity: .95;
    }

    .g-progress{
      margin-top: 8px;
      height: 8px;
      border-radius: 999px;
      background: rgba(0,0,0,.22);
      border: 1px solid rgba(255,255,255,.10);
      overflow:hidden;
    }

    .g-progress > div{
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, rgba(168,240,179,.92), rgba(120,217,138,.92));
      box-shadow: 0 0 18px rgba(168,240,179,.12);
    }

    /* progress tint per column */
    .g-col[data-col="not_active"] .g-progress > div{
      background: linear-gradient(90deg, rgba(180,190,195,.85), rgba(210,220,225,.75));
      box-shadow: 0 0 16px rgba(180,190,195,.10);
    }
    .g-col[data-col="planned"] .g-progress > div{
      background: linear-gradient(90deg, rgba(120,170,255,.90), rgba(80,145,255,.85));
      box-shadow: 0 0 16px rgba(120,170,255,.12);
    }
    .g-col[data-col="in_progress"] .g-progress > div{
      background: linear-gradient(90deg, rgba(245,200,90,.92), rgba(230,180,70,.85));
      box-shadow: 0 0 16px rgba(245,200,90,.12);
    }
    .g-col[data-col="done"] .g-progress > div{
      background: linear-gradient(90deg, rgba(110,220,160,.92), rgba(60,190,120,.85));
      box-shadow: 0 0 16px rgba(110,220,160,.12);
    }

    .g-foot{
      margin-top: 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      color: rgba(232,242,238,.78);
      font-size: 11px;
      font-weight: 900;
      opacity: .95;
    }

    .error{
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,80,80,.25);
      background: rgba(255,80,80,.06);
      color: rgba(232,242,238,.90);
      font-size: 12px;
      font-weight: 750;
      line-height: 1.35;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <!-- HQ Header -->
    <div class="hq">
      <h1 class="hq-title">HQ</h1>
      <div class="hq-rule"></div>

      <!-- Weather -->
      <div class="weather-row" aria-label="San Antonio weather">
        <div class="w-left">
          <div class="w-city">SAN ANTONIO</div>
          <div class="w-label">WEATHER</div>
        </div>

        <div class="w-icon" id="weatherIcon" aria-hidden="true"></div>

        <div class="w-right">
          <div class="w-temp" id="weatherTemp">— °F</div>
          <div class="w-desc" id="weatherDesc">loading…</div>
          <div class="w-meta">
            <span id="tzLabel" class="tag">TZ: —</span>
            <span id="weatherUpdated" class="tag">Updated: —</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Main grid -->
    <div class="grid">
      <div class="panel">
        <h2>Vacation Countdowns</h2>
        <div id="countdownList" class="countdown-list"></div>
        <div class="hint">
          Edit trips inside <b>CONFIG.countdowns</b> in the code.
        </div>
      </div>

      <div class="panel life">
        <h2>Remaining Life</h2>

        <div class="life-box" aria-label="Life progress bar">
          <div class="life-fill" id="lifeFill" style="width:35%"></div>
          <div class="life-overlay"></div>
        </div>

        <div class="life-text">
          <div id="lifeSummary">Life: —</div>
          <div class="pct" id="lifePct">—%</div>
        </div>

        <div class="life-row">
          <div id="lifeDates">DOB — → End —</div>
          <div id="lifeAge">Age —</div>
        </div>

        <div class="small">
          This is a visualization: (today - DOB) ÷ (end - DOB). You control the end date.
        </div>

        <div class="hint">
          Edit <b>CONFIG.life.dob</b> and <b>CONFIG.life.end</b>.
        </div>
      </div>
    </div>

    <!-- Goals section -->
    <div class="section">
      <div class="section-title">
        <h2>↗ <span id="goalsTitle">Short Term Goals</span></h2>
        <div class="meta" id="goalsMeta">Loading goals…</div>
      </div>

      <div id="goalsBoard" class="goals-board"></div>
      <div id="goalsError" class="error" style="display:none;"></div>

      <div class="hint">
        Edit goals in <b>goals.json</b> (repo root). Commit + push to update Notion.
      </div>
    </div>
  </div>

  <script>
    /**
     * =========================
     * CONFIG — EDIT THIS
     * =========================
     */
    const CONFIG = {
      timezoneLabel: "America/Chicago",

      countdowns: [
        { name: "Savannah, Georgia", date: "2026-01-30" },
        { name: "Santa Fe Photo Trip", date: "2026-02-26" },
        { name: "Splash House", date: "2026-08-08" }
      ],

      life: {
        dob: "1998-03-30",
        end: "2078-03-30",
        showRemainingPercent: false
      },

      weather: {
        cityLabel: "San Antonio",
        latitude: 29.4241,
        longitude: -98.4936,
        refreshMinutes: 15
      },

      goals: {
        url: "./goals.json",
        refreshMinutes: 10
      }
    };

    // ---------- Utilities ----------
    const pad2 = (n) => String(n).padStart(2, "0");
    const clampPct = (p) => Math.max(0, Math.min(100, Number(p) || 0));

    function formatShortDate(d){
      return d.toLocaleDateString(undefined, { year:"numeric", month:"short", day:"2-digit" });
    }

    function parseLocalDate(input){
      if (/^\d{4}-\d{2}-\d{2}$/.test(input)) {
        const [y,m,day] = input.split("-").map(Number);
        return new Date(y, m-1, day, 0, 0, 0, 0);
      }
      return new Date(input);
    }

    // Returns { months, weeks, days, isPast }
    function diffToTarget(now, target){
      const isPast = now >= target;
      if (isPast) return { months:0, weeks:0, days:0, isPast:true };

      let months = 0;
      let cursor = new Date(now.getTime());
      cursor.setHours(0,0,0,0);

      const tgt = new Date(target.getTime());
      tgt.setHours(0,0,0,0);

      while (true) {
        const next = new Date(cursor.getTime());
        next.setMonth(next.getMonth() + 1);
        if (next <= tgt) {
          months++;
          cursor = next;
        } else break;
      }

      const msPerDay = 24*60*60*1000;
      const remainingDaysTotal = Math.max(0, Math.floor((tgt - cursor) / msPerDay));
      const weeks = Math.floor(remainingDaysTotal / 7);
      const days = remainingDaysTotal % 7;

      return { months, weeks, days, isPast:false };
    }

    function buildCountdownCard(item){
      const target = parseLocalDate(item.date);

      const card = document.createElement("div");
      card.className = "cd-card";

      const head = document.createElement("div");
      head.className = "cd-head";

      const name = document.createElement("div");
      name.className = "cd-name";
      name.textContent = item.name;

      const date = document.createElement("div");
      date.className = "cd-date";
      date.textContent = formatShortDate(target);

      head.appendChild(name);
      head.appendChild(date);

      const tiles = document.createElement("div");
      tiles.className = "tiles";

      const makeTile = (label) => {
        const t = document.createElement("div");
        t.className = "tile";
        const num = document.createElement("div");
        num.className = "num";
        num.textContent = "00";
        const lab = document.createElement("div");
        lab.className = "label";
        lab.textContent = label;
        t.appendChild(num);
        t.appendChild(lab);
        return { t, num };
      };

      const m = makeTile("Months");
      const w = makeTile("Weeks");
      const d = makeTile("Days");

      const togo = document.createElement("div");
      togo.className = "to-go";
      togo.textContent = "to go";

      tiles.appendChild(m.t);
      tiles.appendChild(w.t);
      tiles.appendChild(d.t);
      tiles.appendChild(togo);

      card.appendChild(head);
      card.appendChild(tiles);

      return { card, target, nodes: { m:m.num, w:w.num, d:d.num, togo } };
    }

    function updateCountdown(cardObj){
      const now = new Date();
      const diff = diffToTarget(now, cardObj.target);
      cardObj.nodes.m.textContent = pad2(diff.months);
      cardObj.nodes.w.textContent = pad2(diff.weeks);
      cardObj.nodes.d.textContent = pad2(diff.days);
      cardObj.nodes.togo.textContent = diff.isPast ? "done" : "to go";
    }

    function updateLife(){
      const dob = parseLocalDate(CONFIG.life.dob);
      const end = parseLocalDate(CONFIG.life.end);
      const now = new Date();

      const total = Math.max(1, end - dob);
      const lived = Math.min(Math.max(0, now - dob), total);

      const livedPct = (lived / total) * 100;
      const remainingPct = 100 - livedPct;

      const pct = CONFIG.life.showRemainingPercent ? remainingPct : livedPct;

      const lifeFill = document.getElementById("lifeFill");
      const lifePctEl = document.getElementById("lifePct");
      const lifeSummary = document.getElementById("lifeSummary");
      const lifeDates = document.getElementById("lifeDates");
      const lifeAge = document.getElementById("lifeAge");

      lifeFill.style.width = `${Math.max(0, Math.min(100, pct)).toFixed(1)}%`;
      lifePctEl.textContent = `${pct.toFixed(1)}%`;

      const label = CONFIG.life.showRemainingPercent ? "Remaining" : "Lived";
      lifeSummary.textContent = `${label}: ${pct.toFixed(1)}%`;

      lifeDates.textContent = `DOB ${formatShortDate(dob)} → End ${formatShortDate(end)}`;

      let age = now.getFullYear() - dob.getFullYear();
      const m = now.getMonth() - dob.getMonth();
      if (m < 0 || (m === 0 && now.getDate() < dob.getDate())) age--;
      lifeAge.textContent = `Age ${age}`;
    }

    // ---------- Weather (Open-Meteo, no key) ----------
    function weatherCodeToText(code){
      if (code === 0) return "clear sky";
      if (code === 1) return "mainly clear";
      if (code === 2) return "partly cloudy";
      if (code === 3) return "overcast clouds";
      if (code === 45 || code === 48) return "fog";
      if (code === 51 || code === 53 || code === 55) return "drizzle";
      if (code === 56 || code === 57) return "freezing drizzle";
      if (code === 61 || code === 63 || code === 65) return "rain";
      if (code === 66 || code === 67) return "freezing rain";
      if (code === 71 || code === 73 || code === 75) return "snow";
      if (code === 77) return "snow grains";
      if (code === 80 || code === 81 || code === 82) return "rain showers";
      if (code === 85 || code === 86) return "snow showers";
      if (code === 95) return "thunderstorm";
      if (code === 96 || code === 99) return "thunderstorm w/ hail";
      return "conditions";
    }

    function iconSVG(kind){
      const stroke = "rgba(232,242,238,.85)";
      const fill = "rgba(232,242,238,.18)";
      const accent = "rgba(168,240,179,.85)";

      if (kind === "sun") {
        return `
          <svg width="34" height="34" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <circle cx="12" cy="12" r="4.5" stroke="${accent}" stroke-width="1.6"/>
            <path d="M12 2v3M12 19v3M2 12h3M19 12h3M4.2 4.2l2.1 2.1M17.7 17.7l2.1 2.1M19.8 4.2l-2.1 2.1M6.3 17.7l-2.1 2.1"
              stroke="${stroke}" stroke-width="1.2" stroke-linecap="round"/>
          </svg>`;
      }

      if (kind === "cloud") {
        return `
          <svg width="34" height="34" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M8.5 18h9a4 4 0 0 0 .7-7.94A5.5 5.5 0 0 0 7.2 8.8 3.8 3.8 0 0 0 8.5 18Z"
              fill="${fill}" stroke="${stroke}" stroke-width="1.2" />
          </svg>`;
      }

      if (kind === "rain") {
        return `
          <svg width="34" height="34" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M8.5 14.5h9a3.5 3.5 0 0 0 .6-6.95A5 5 0 0 0 7.3 6.6 3.3 3.3 0 0 0 8.5 14.5Z"
              fill="${fill}" stroke="${stroke}" stroke-width="1.2" />
            <path d="M9 17l-1 2M13 17l-1 2M17 17l-1 2" stroke="${accent}" stroke-width="1.4" stroke-linecap="round"/>
          </svg>`;
      }

      if (kind === "storm") {
        return `
          <svg width="34" height="34" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M8.5 14.5h9a3.5 3.5 0 0 0 .6-6.95A5 5 0 0 0 7.3 6.6 3.3 3.3 0 0 0 8.5 14.5Z"
              fill="${fill}" stroke="${stroke}" stroke-width="1.2" />
            <path d="M12 14.8l-2 3h2l-1 2.8 3-4h-2l1-1.8Z" fill="${accent}" />
          </svg>`;
      }

      return iconSVG("cloud");
    }

    function pickIcon(weatherCode){
      if (weatherCode === 0 || weatherCode === 1) return "sun";
      if (weatherCode === 2 || weatherCode === 3 || weatherCode === 45 || weatherCode === 48) return "cloud";
      if ([51,53,55,56,57,61,63,65,66,67,80,81,82,71,73,75,77,85,86].includes(weatherCode)) return "rain";
      if ([95,96,99].includes(weatherCode)) return "storm";
      return "cloud";
    }

    async function refreshWeather(){
      const tempEl = document.getElementById("weatherTemp");
      const descEl = document.getElementById("weatherDesc");
      const iconEl = document.getElementById("weatherIcon");
      const updatedEl = document.getElementById("weatherUpdated");

      try {
        const lat = CONFIG.weather.latitude;
        const lon = CONFIG.weather.longitude;
        const tz = encodeURIComponent(CONFIG.timezoneLabel);

        const url =
          `https://api.open-meteo.com/v1/forecast` +
          `?latitude=${lat}&longitude=${lon}` +
          `&current=temperature_2m,weather_code` +
          `&temperature_unit=fahrenheit` +
          `&timezone=${tz}`;

        const res = await fetch(url, { cache: "no-store" });
        if (!res.ok) throw new Error(`Weather fetch failed: ${res.status}`);
        const data = await res.json();

        const t = data?.current?.temperature_2m;
        const code = data?.current?.weather_code;

        if (typeof t !== "number" || typeof code !== "number") {
          throw new Error("Weather data missing fields");
        }

        tempEl.textContent = `${Math.round(t)} °F`;
        descEl.textContent = weatherCodeToText(code);

        const iconKind = pickIcon(code);
        iconEl.innerHTML = iconSVG(iconKind);

        const now = new Date();
        updatedEl.textContent = `Updated: ${now.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" })}`;
      } catch (e) {
        descEl.textContent = "weather unavailable";
        iconEl.innerHTML = iconSVG("cloud");
        updatedEl.textContent = "Updated: —";
      }
    }

    // ---------- Goals (goals.json) ----------
    function renderGoals(boardData){
      const titleEl = document.getElementById("goalsTitle");
      const metaEl = document.getElementById("goalsMeta");
      const boardEl = document.getElementById("goalsBoard");
      const errEl = document.getElementById("goalsError");

      errEl.style.display = "none";
      errEl.textContent = "";

      titleEl.textContent = boardData.title || "Short Term Goals";
      boardEl.innerHTML = "";

      const cols = Array.isArray(boardData.columns) ? boardData.columns : [];
      let totalItems = 0;

      cols.forEach(col => {
        const items = Array.isArray(col.items) ? col.items : [];
        totalItems += items.length;

        const colEl = document.createElement("div");
        colEl.className = "g-col";
        colEl.setAttribute("data-col", col.id || "");

        const head = document.createElement("div");
        head.className = "g-colhead";

        const pill = document.createElement("div");
        pill.className = "g-pill";
        pill.textContent = col.name || "Column";

        const count = document.createElement("div");
        count.className = "g-count";
        count.textContent = String(items.length);

        head.appendChild(pill);
        head.appendChild(count);

        const list = document.createElement("div");
        list.className = "g-list";

        items.forEach(it => {
          const card = document.createElement("div");
          card.className = "g-card";

          const row = document.createElement("div");
          row.className = "g-row";

          const title = document.createElement("div");
          title.className = "g-title";

          const emoji = document.createElement("div");
          emoji.className = "g-emoji";
          emoji.textContent = it.emoji || "•";

          const text = document.createElement("div");
          text.textContent = it.title || "Untitled";

          title.appendChild(emoji);
          title.appendChild(text);

          const meta = document.createElement("div");
          meta.className = "g-meta";
          meta.textContent = it.meta || "";

          row.appendChild(title);
          if (it.meta) row.appendChild(meta);

          const progressWrap = document.createElement("div");
          progressWrap.className = "g-progress";

          const bar = document.createElement("div");
          const pct = clampPct(it.progress);
          bar.style.width = `${pct}%`;

          progressWrap.appendChild(bar);

          const foot = document.createElement("div");
          foot.className = "g-foot";

          const left = document.createElement("div");
          left.textContent = "";

          const pctEl = document.createElement("div");
          pctEl.textContent = `${pct.toFixed(0)}%`;

          foot.appendChild(left);
          foot.appendChild(pctEl);

          card.appendChild(row);
          card.appendChild(progressWrap);
          card.appendChild(foot);

          list.appendChild(card);
        });

        colEl.appendChild(head);
        colEl.appendChild(list);
        boardEl.appendChild(colEl);
      });

      metaEl.textContent = `${totalItems} total`;
    }

    async function refreshGoals(){
      const metaEl = document.getElementById("goalsMeta");
      const errEl = document.getElementById("goalsError");

      try {
        const bust = `cb=${Date.now()}`;
        const url = CONFIG.goals.url.includes("?")
          ? `${CONFIG.goals.url}&${bust}`
          : `${CONFIG.goals.url}?${bust}`;

        const res = await fetch(url, { cache: "no-store" });
        if (!res.ok) throw new Error(`goals.json fetch failed: ${res.status}`);
        const data = await res.json();
        renderGoals(data);

        const now = new Date();
        metaEl.textContent = `${metaEl.textContent} • updated ${now.toLocaleTimeString([], { hour:"2-digit", minute:"2-digit" })}`;
      } catch (e) {
        errEl.style.display = "block";
        errEl.textContent =
          "Could not load goals.json. Make sure goals.json is in the repo root and GitHub Pages has redeployed.\n" +
          "Tip: open your site directly (not inside Notion) to confirm it loads first.";
        metaEl.textContent = "Goals unavailable";
      }
    }

    // ---------- Init ----------
    document.getElementById("tzLabel").textContent = `TZ: ${CONFIG.timezoneLabel}`;

    const list = document.getElementById("countdownList");
    const cardObjs = CONFIG.countdowns.map(item => {
      const obj = buildCountdownCard(item);
      list.appendChild(obj.card);
      return obj;
    });

    function tick(){
      cardObjs.forEach(updateCountdown);
      updateLife();
    }

    tick();
    refreshWeather();
    refreshGoals();

    setInterval(tick, 60 * 1000);
    setInterval(refreshWeather, CONFIG.weather.refreshMinutes * 60 * 1000);
    setInterval(refreshGoals, CONFIG.goals.refreshMinutes * 60 * 1000);
  </script>
</body>
</html>
