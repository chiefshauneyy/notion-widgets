<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Short Term Goals</title>
  <style>
    :root{
      --bg0:#0b0d0c;
      --text:#e8f2ee;
      --muted:#9aa7a3;

      --shadow: 0 10px 30px rgba(0,0,0,.45);
      --radius: 18px;

      /* Notion-like column colors */
      --na-bg: rgba(255,255,255,.04);
      --na-border: rgba(255,255,255,.10);

      --pl-bg: rgba(80, 145, 255, .13);
      --pl-border: rgba(80, 145, 255, .25);

      --ip-bg: rgba(230, 180, 70, .13);
      --ip-border: rgba(230, 180, 70, .25);

      --dn-bg: rgba(60, 190, 120, .13);
      --dn-border: rgba(60, 190, 120, .25);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background: radial-gradient(1200px 800px at 50% 0%, #141a18 0%, var(--bg0) 55%, #070807 100%);
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding: 20px 18px 26px;
    }

    .wrap{
      width: 980px;
      max-width: 100%;
    }

    .header{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap: 14px;
      margin-bottom: 12px;
      padding-top: 8px;
      border-top: 1px solid rgba(255,255,255,.10);
    }

    .header h1{
      margin:0;
      font-size: 20px;
      font-weight: 950;
      letter-spacing:.2px;
      display:flex;
      align-items:center;
      gap: 10px;
    }

    .meta{
      color: rgba(154,167,163,.95);
      font-size: 12px;
      font-weight: 800;
      white-space: nowrap;
    }

    .board{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 14px;
    }

    @media (max-width: 980px){
      .board{ grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 520px){
      .board{ grid-template-columns: 1fr; }
    }

    .col{
      border-radius: 16px;
      padding: 12px;
      box-shadow: 0 10px 26px rgba(0,0,0,.26);
      min-height: 180px;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.12);
      position: relative;
      overflow: hidden;
    }

    .col[data-col="not_active"]{
      background: linear-gradient(180deg, var(--na-bg), rgba(0,0,0,.16));
      border-color: var(--na-border);
    }
    .col[data-col="planned"]{
      background: linear-gradient(180deg, var(--pl-bg), rgba(0,0,0,.16));
      border-color: var(--pl-border);
    }
    .col[data-col="in_progress"]{
      background: linear-gradient(180deg, var(--ip-bg), rgba(0,0,0,.16));
      border-color: var(--ip-border);
    }
    .col[data-col="done"]{
      background: linear-gradient(180deg, var(--dn-bg), rgba(0,0,0,.16));
      border-color: var(--dn-border);
    }

    .col::after{
      content:"";
      position:absolute;
      inset:-40% -20% auto -20%;
      height: 65%;
      background: radial-gradient(circle at 50% 50%, rgba(255,255,255,.08), rgba(255,255,255,0) 60%);
      opacity:.35;
      pointer-events:none;
    }

    .colhead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      margin-bottom: 10px;
      position: relative;
      z-index: 1;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      font-size: 12px;
      font-weight: 950;
      letter-spacing:.2px;
      color: rgba(232,242,238,.94);
    }

    .count{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      min-width: 26px;
      height: 22px;
      padding: 0 8px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 950;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      color: rgba(232,242,238,.90);
    }

    .list{
      display:flex;
      flex-direction:column;
      gap: 10px;
      position: relative;
      z-index: 1;
    }

    .card{
      border-radius: 14px;
      padding: 10px 10px 9px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.14);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
    }

    .col[data-col="planned"] .card{ background: rgba(80,145,255,.10); border-color: rgba(80,145,255,.18); }
    .col[data-col="in_progress"] .card{ background: rgba(230,180,70,.10); border-color: rgba(230,180,70,.18); }
    .col[data-col="done"] .card{ background: rgba(60,190,120,.10); border-color: rgba(60,190,120,.18); }
    .col[data-col="not_active"] .card{ background: rgba(255,255,255,.04); border-color: rgba(255,255,255,.10); }

    .row{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 10px;
    }

    .title{
      font-size: 13px;
      font-weight: 950;
      line-height: 1.25;
      color: rgba(232,242,238,.94);
      display:flex;
      gap: 8px;
      align-items:flex-start;
    }

    .emoji{ width: 18px; text-align:center; }

    .meta2{
      color: rgba(232,242,238,.78);
      font-size: 12px;
      font-weight: 900;
      white-space: nowrap;
      margin-top: 1px;
      opacity: .95;
    }

    .progress{
      margin-top: 8px;
      height: 8px;
      border-radius: 999px;
      background: rgba(0,0,0,.22);
      border: 1px solid rgba(255,255,255,.10);
      overflow:hidden;
    }

    .progress > div{
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, rgba(168,240,179,.92), rgba(120,217,138,.92));
      box-shadow: 0 0 18px rgba(168,240,179,.12);
    }

    .col[data-col="not_active"] .progress > div{
      background: linear-gradient(90deg, rgba(180,190,195,.85), rgba(210,220,225,.75));
    }
    .col[data-col="planned"] .progress > div{
      background: linear-gradient(90deg, rgba(120,170,255,.90), rgba(80,145,255,.85));
    }
    .col[data-col="in_progress"] .progress > div{
      background: linear-gradient(90deg, rgba(245,200,90,.92), rgba(230,180,70,.85));
    }
    .col[data-col="done"] .progress > div{
      background: linear-gradient(90deg, rgba(110,220,160,.92), rgba(60,190,120,.85));
    }

    .foot{
      margin-top: 10px;
      display:flex;
      align-items:center;
      justify-content:flex-end;
      color: rgba(232,242,238,.78);
      font-size: 11px;
      font-weight: 900;
      opacity: .95;
    }

    .error{
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,80,80,.25);
      background: rgba(255,80,80,.06);
      color: rgba(232,242,238,.90);
      font-size: 12px;
      font-weight: 750;
      line-height: 1.35;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="header">
      <h1>↗ <span id="title">Short Term Goals</span></h1>
      <div class="meta" id="meta">Loading…</div>
    </div>

    <div id="board" class="board"></div>
    <div id="err" class="error" style="display:none;"></div>
  </div>

  <script>
    const CONFIG = {
      goalsUrl: "./goals.json",
      refreshMinutes: 10
    };

    const clampPct = (p) => Math.max(0, Math.min(100, Number(p) || 0));

    function render(data){
      const titleEl = document.getElementById("title");
      const metaEl = document.getElementById("meta");
      const boardEl = document.getElementById("board");
      const errEl = document.getElementById("err");

      errEl.style.display = "none";
      errEl.textContent = "";
      boardEl.innerHTML = "";

      titleEl.textContent = data.title || "Short Term Goals";

      const cols = Array.isArray(data.columns) ? data.columns : [];
      let total = 0;

      cols.forEach(col => {
        const items = Array.isArray(col.items) ? col.items : [];
        total += items.length;

        const colEl = document.createElement("div");
        colEl.className = "col";
        colEl.setAttribute("data-col", col.id || "");

        const head = document.createElement("div");
        head.className = "colhead";

        const pill = document.createElement("div");
        pill.className = "pill";
        pill.textContent = col.name || "Column";

        const count = document.createElement("div");
        count.className = "count";
        count.textContent = String(items.length);

        head.appendChild(pill);
        head.appendChild(count);

        const list = document.createElement("div");
        list.className = "list";

        items.forEach(it => {
          const card = document.createElement("div");
          card.className = "card";

          const row = document.createElement("div");
          row.className = "row";

          const title = document.createElement("div");
          title.className = "title";

          const emoji = document.createElement("div");
          emoji.className = "emoji";
          emoji.textContent = it.emoji || "•";

          const text = document.createElement("div");
          text.textContent = it.title || "Untitled";

          title.appendChild(emoji);
          title.appendChild(text);

          row.appendChild(title);

          if (it.meta) {
            const meta = document.createElement("div");
            meta.className = "meta2";
            meta.textContent = it.meta;
            row.appendChild(meta);
          }

          const progress = document.createElement("div");
          progress.className = "progress";

          const bar = document.createElement("div");
          const pct = clampPct(it.progress);
          bar.style.width = `${pct}%`;

          progress.appendChild(bar);

          const foot = document.createElement("div");
          foot.className = "foot";
          foot.textContent = `${pct.toFixed(0)}%`;

          card.appendChild(row);
          card.appendChild(progress);
          card.appendChild(foot);

          list.appendChild(card);
        });

        colEl.appendChild(head);
        colEl.appendChild(list);
        boardEl.appendChild(colEl);
      });

      metaEl.textContent = `${total} total`;
    }

    async function refresh(){
      const metaEl = document.getElementById("meta");
      const errEl = document.getElementById("err");

      try {
        const bust = `cb=${Date.now()}`;
        const url = CONFIG.goalsUrl.includes("?")
          ? `${CONFIG.goalsUrl}&${bust}`
          : `${CONFIG.goalsUrl}?${bust}`;

        const res = await fetch(url, { cache: "no-store" });
        if (!res.ok) throw new Error(`goals.json fetch failed: ${res.status}`);
        const data = await res.json();

        render(data);

        const now = new Date();
        metaEl.textContent = `${metaEl.textContent} • updated ${now.toLocaleTimeString([], { hour:"2-digit", minute:"2-digit" })}`;
      } catch (e) {
        errEl.style.display = "block";
        errEl.textContent =
          "Could not load goals.json. Make sure goals.json is in the repo root and GitHub Pages redeployed successfully.";
        metaEl.textContent = "Unavailable";
      }
    }

    refresh();
    setInterval(refresh, CONFIG.refreshMinutes * 60 * 1000);
  </script>
</body>
</html>
